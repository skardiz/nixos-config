#!/bin/bash

# --- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å ---
set -e

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
REPO_DIR="/home/alex/nixos-config"

# --- –õ–æ–≥–∏–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ ---
echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."

cd "$REPO_DIR" || { echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–∞–ø–∫—É $REPO_DIR"; exit 1; }

if [ -z "$(git status --porcelain)" ]; then
  echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. –í—Å–µ —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ."
  exit 0
fi

echo "üîÑ –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ..."
git add --all

read -p "üí¨ –í–≤–µ–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç'): " COMMIT_MSG

if [ -z "$COMMIT_MSG" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º."
  exit 1
fi

echo "üìù –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç..."
git commit -m "$COMMIT_MSG"

echo "‚òÅÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub..."
git push

echo "üéâ –ì–æ—Ç–æ–≤–æ! –í–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –Ω–∞ GitHub."
