#!/bin/bash

# --- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å ---
# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –ª—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π
set -e

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
# –ü—É—Ç—å –∫ –≤–∞—à–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
REPO_DIR="/home/alex/nixos-config"

# --- –õ–æ–≥–∏–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ ---

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."

# 1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd "$REPO_DIR" || { echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–∞–ø–∫—É $REPO_DIR"; exit 1; }

# 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
# --porcelain –≤—ã–≤–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ä—É–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
# –ï—Å–ª–∏ –≤—ã–≤–æ–¥ –ø—É—Å—Ç–æ–π, –∑–Ω–∞—á–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç.
if [ -z "$(git status --porcelain)" ]; then
  echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. –í—Å–µ —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ."
  exit 0
fi

# 3. –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –Ω–æ–≤—ã–µ, –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∏ —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
# --all –∏–ª–∏ -A –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã.
echo "üîÑ –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ..."
git add --all

# 4. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –≤–∞—Å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞)
read -p "üí¨ –í–≤–µ–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç'): " COMMIT_MSG

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø—É—Å—Ç–æ–µ
if [ -z "$COMMIT_MSG" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º."
  exit 1
fi

# 5. –î–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç —Å –≤–∞—à–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
echo "üìù –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç..."
git commit -m "$COMMIT_MSG"

# 6. –ü—É–±–ª–∏–∫—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub
echo "‚òÅÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ GitHub..."
git push

# --- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ ---
echo "üéâ –ì–æ—Ç–æ–≤–æ! –í–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –Ω–∞ GitHub."

