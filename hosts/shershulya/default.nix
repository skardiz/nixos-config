# hosts/shershulya/default.nix
{ config, pkgs, inputs, lib, ... }:

{
  # --------------------------------------------------------------------
  # 1. Импорты: Подключаем все необходимые части нашего города.
  # --------------------------------------------------------------------
  imports = [
    # Подключаем описание нашего железа (диски, загрузчик).
    ./hardware-configuration.nix

    # Подключаем общие для всех хостов правила.
    ../_common/default.nix

    # Подключаем "роль" рабочего стола, которая собирает все нужные фичи.
    ../../modules/roles/desktop.nix

    # Подключаем модули для нашего конкретного оборудования.
    ../../modules/hardware/nvidia-pascal.nix
    ../../modules/hardware/intel-cpu.nix

    # --- ГЛАВНОЕ ИЗМЕНЕНИЕ! ---
    # Мы подключаем наш новый, надежный сервис-медвежатник.
    # Он сам позаботится о расшифровке и настройке Nix.
    ../../modules/features/sops-service.nix
  ];

  # --------------------------------------------------------------------
  # 2. Удаление старого: ВСЕ СТАРОЕ УДАЛЕНО.
  # --------------------------------------------------------------------
  # Мы полностью убрали отсюда блоки `sops = { ... };` и
  # `nix.settings = { ... };`. Наш новый модуль 'sops-service.nix'
  # теперь управляет этим централизованно. Этот файл стал
  # чище и отвечает только за высокоуровневую сборку.

  # --------------------------------------------------------------------
  # 3. Система: Уникальные настройки для этого хоста.
  # --------------------------------------------------------------------
  networking.hostName = "shershulya";
  system.stateVersion = "25.11";

  # --------------------------------------------------------------------
  # 4. Пользователи: Определяем, кто живет в этом городе.
  # --------------------------------------------------------------------
  my.users.accounts = {
    alex = {
      isMainUser = true;
      description = "Alex";
      extraGroups = [ "adbusers" ];
    };
    mari = {
      description = "Mari";
    };
  };
}
