# NixOS Citadel: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è shershulya

> "–•–æ—Ä–æ—à–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –Ω–µ —É–∫—Ä–∞—à–∞–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∞ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç —É–∫—Ä–∞—à–µ–Ω–∏—è."
> ‚Äî –ê–≤–≥—É—Å—Ç –ü—å—é–¥–∂–∏–Ω

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä "–¥–æ—Ç—Ñ–∞–π–ª–æ–≤". –≠—Ç–æ –º–æ—è –ª–∏—á–Ω–∞—è, –∂–∏–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ NixOS: —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–π, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π –∏ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ—Ä–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏, —Ä–∞–±–æ—Ç—ã –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.

## ‚ú® –§–∏–ª–æ—Å–æ—Ñ–∏—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–≠—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞—Ö, –∞ –Ω–∞ **–∏–¥–µ—è—Ö**:

1.  **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å –∫–∞–∫ –≤ LEGO:** –ö–∞–∂–¥—ã–π –∞—Å–ø–µ–∫—Ç —Å–∏—Å—Ç–µ–º—ã ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π, —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π "–∫–∏—Ä–ø–∏—á–∏–∫" (`modules/features`). –ú—ã –Ω–µ —Å—Ç—Ä–æ–∏–º –º–æ–Ω–æ–ª–∏—Ç, –º—ã —Å–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

2.  **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ü—É–ª—å—Ç –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —Ä–∞–∑–±—Ä–∞—Å—ã–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ, –º—ã —Å–æ–∑–¥–∞–ª–∏ –µ–¥–∏–Ω—ã–π "–ø—É–ª—å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è" (`modules/core/options.nix`). –•–æ—á–µ—à—å –≤–∫–ª—é—á–∏—Ç—å –∏–≥—Ä—ã –∏–ª–∏ Android? –ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

3.  **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –í–ª–∞—Å—Ç–µ–π:**
    *   **–°–∏—Å—Ç–µ–º–∞ (`NixOS`)** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, —Å—Ç–µ–Ω—ã –∏ –≥–æ—Ä–æ–¥—Å–∫–∏–µ —Å–ª—É–∂–±—ã.
    *   **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`Home Manager`)** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–µ–±–µ–ª—å, –æ–±–æ–∏ –∏ –ª–∏—á–Ω—ã–µ –≤–µ—â–∏ –≤ —Å–≤–æ–µ–π –∫–≤–∞—Ä—Ç–∏—Ä–µ. –≠—Ç–∏ –¥–≤–∞ –º–∏—Ä–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

4.  **–ù–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —á–µ—Ä–µ–∑ —ç—Ç–∞–ø —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–æ—â–µ–Ω–∏—è. –ú—ã –∏–∑–±–∞–≤–∏–ª–∏—Å—å –æ—Ç –≤—Å–µ—Ö —Å–ª–æ–∂–Ω—ã—Ö –æ–≤–µ—Ä–ª–µ–µ–≤ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å–±–æ—Ä–æ–∫ –≤ –ø–æ–ª—å–∑—É —á–∏—Å—Ç–æ—Ç—ã –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

## üó∫Ô∏è –ö–∞—Ä—Ç–∞ –¶–∏—Ç–∞–¥–µ–ª–∏: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

–≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–≥–æ–≥–æ –ø—É—Ç–∏. –û–Ω–∞ ‚Äî —Å–µ—Ä–¥—Ü–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.
```
.
‚îú‚îÄ‚îÄ flake.nix # <<< –ì–ª–∞–≤–Ω—ã–µ –í–æ—Ä–æ—Ç–∞ –∏ –¢–∞–º–æ–∂–Ω—è >>>
‚îÇ # –ó–¥–µ—Å—å –º—ã –æ–±—ä—è–≤–ª—è–µ–º –≤—Å–µ –Ω–∞—à–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞.
‚îÇ
‚îú‚îÄ‚îÄ hosts/ # <<< –ö–æ–º–∞–Ω–¥–Ω—ã–π –¶–µ–Ω—Ç—Ä >>>
‚îÇ ‚îú‚îÄ‚îÄ shershulya/ # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∞—à–∏–Ω—ã "shershulya".
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ default.nix # -- –ì–ï–ù–ï–†–ê–õ–¨–ù–´–ô –ü–õ–ê–ù -- –ì–æ–≤–æ—Ä–∏—Ç, –∫–∞–∫–∏–µ "—Ä–æ–ª–∏" –∏
‚îÇ ‚îÇ # "–æ–ø—Ü–∏–∏" –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞.
‚îÇ ‚îî‚îÄ‚îÄ _common/ # -- –ö–û–ù–°–¢–ò–¢–£–¶–ò–Ø -- –û–±—â–∏–µ –∑–∞–∫–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤.
‚îÇ
‚îú‚îÄ‚îÄ modules/ # <<< –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ë—é—Ä–æ >>> –ù–∞—à–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —á–µ—Ä—Ç–µ–∂–µ–π.
‚îÇ ‚îú‚îÄ‚îÄ core/ # -- –Ø–î–†–û -- –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏.
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ options.nix # -- –ü–£–õ–¨–¢ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -- –ù–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã.
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ users.nix # -- –ü–ê–°–ü–û–†–¢–ù–´–ô –°–¢–û–õ -- –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ –∂–∏—Ç–µ–ª—è–º–∏.
‚îÇ ‚îú‚îÄ‚îÄ features/ # -- –°–ö–õ–ê–î –§–ò–ß -- –Ø—â–∏–∫–∏ —Å "—Ç—è–∂–µ–ª—ã–º–∏" –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.
‚îÇ ‚îú‚îÄ‚îÄ hardware/ # –ú–æ–¥—É–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∂–µ–ª–µ–∑–∞.
‚îÇ ‚îî‚îÄ‚îÄ roles/ # -- –¢–ò–ü–û–í–´–ï –ü–†–û–ï–ö–¢–´ -- –ì–æ—Ç–æ–≤—ã–µ "–Ω–∞–±–æ—Ä—ã LEGO" –∏–∑ —Ñ–∏—á.
‚îÇ
‚îî‚îÄ‚îÄ home/ # <<< –ñ–∏–ª–æ–π –ö–æ–º–ø–ª–µ–∫—Å >>> –õ–∏—á–Ω—ã–µ –≤–µ—â–∏ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
‚îú‚îÄ‚îÄ alex/ # –ö–≤–∞—Ä—Ç–∏—Ä–∞ –ê–ª–µ–∫—Å–∞.
‚îú‚îÄ‚îÄ mari/ # –ö–≤–∞—Ä—Ç–∏—Ä–∞ –ú–∞—Ä–∏.
‚îî‚îÄ‚îÄ _common/ # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–µ–±–µ–ª—å –∏ —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–≤–∞—Ä—Ç–∏—Ä.
```
## üíé –ñ–µ–º—á—É–∂–∏–Ω—ã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–í —ç—Ç–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—à–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–º–∏ —è –æ—Å–æ–±–µ–Ω–Ω–æ –≥–æ—Ä–∂—É—Å—å:

*   **–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∏–Ω–∏-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫:** –§–∞–π–ª—ã –≤ `modules/core/` —Å–æ–∑–¥–∞—é—Ç –Ω–∞—à—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é, –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –æ–ø—Ü–∏–π (`my.*`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–æ–π —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–µ –∫–æ–ø–∞—è—Å—å –≤ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

*   **"–£–º–Ω—ã–π" WayDroid:** –ú–æ–¥—É–ª—å `features/android.nix` –Ω–µ –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç WayDroid, –∞ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –≤–º–µ—Å—Ç–µ —Å `waydroid-idle.nix` ‚Äî –Ω–∞—à–∏–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–∂–æ—Ä–ª–∏–≤—ã–π WayDroid –ø–æ—Å–ª–µ 5 –º–∏–Ω—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è.

*   **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å:** –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞—Ç—å `hosts/shershulya/default.nix` –¥–µ—Å—è—Ç–∫–∞–º–∏ –∏–º–ø–æ—Ä—Ç–æ–≤, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º "—Ä–æ–ª–∏" (`roles/desktop.nix`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–¥–Ω–∏–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Å—å –Ω–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∞—à–∏–Ω—ã.

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü–µ—Ä–≤–∏—á–Ω–∞—è –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1.  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ NixOS —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
2.  –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
    `git clone https://github.com/skardiz/nixos-config.git ~/nixos-config`
3.  **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã (–ª–æ–∫–∞–ª—å–Ω–æ):** –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API GitHub –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞. **–≠—Ç–æ—Ç —à–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Git.**
    ```
    mkdir -p ~/.config/nix
    echo "access-tokens = github.com=–í–ê–®_–¢–û–ö–ï–ù_GITHUB" >> ~/.config/nix/nix.conf
    ```
4.  –°–æ–±–µ—Ä–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:
    `sudo nixos-rebuild switch --flake .#shershulya`

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
`sudo nixos-rebuild switch --flake .#shershulya`

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
`nix flake update`

## üèóÔ∏è –ß–µ—Ä—Ç–µ–∂–∏ –ë—É–¥—É—â–∏—Ö –ù–µ–±–æ—Å–∫—Ä–µ–±–æ–≤

–≠—Ç–æ—Ç –≥–æ—Ä–æ–¥ ‚Äî –∂–∏–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º. –í –ø–ª–∞–Ω–∞—Ö:

-   [ ] **–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –°–µ–π—Ñ:** –í–Ω–µ–¥—Ä–∏—Ç—å `sops-nix` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ (–ø–∞—Ä–æ–ª–µ–π, —Ç–æ–∫–µ–Ω–æ–≤, –∫–ª—é—á–µ–π) –ø—Ä—è–º–æ –≤ Git.
-   [ ] **–û—Å–Ω–æ–≤–∞—Ç—å –ö–æ–ª–æ–Ω–∏—é:** –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤—Ç–æ—Ä–æ–π —Ö–æ—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ—É—Ç–±—É–∫), —á—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç—Ç–æ—á–∏—Ç—å –Ω–∞—à—É –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.
-   [ ] **–ó–∞–Ω—è—Ç—å—Å—è –î–∏–∑–∞–π–Ω–æ–º –ò–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `plasma-manager` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ, –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ KDE Plasma, –æ—Ç –æ–±–æ–µ–≤ –¥–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤.

